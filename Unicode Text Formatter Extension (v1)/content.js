const characterMaps = {
  bold: {
    A: "ð—”", B: "ð—•", C: "ð—–", D: "ð——", E: "ð—˜", F: "ð—™", G: "ð—š", H: "ð—›", I: "ð—œ", 
    J: "ð—", K: "ð—ž", L: "ð—Ÿ", M: "ð— ", N: "ð—¡", O: "ð—¢", P: "ð—£", Q: "ð—¤", R: "ð—¥", 
    S: "ð—¦", T: "ð—§", U: "ð—¨", V: "ð—©", W: "ð—ª", X: "ð—«", Y: "ð—¬", Z: "ð—­",
    a: "ð—®", b: "ð—¯", c: "ð—°", d: "ð—±", e: "ð—²", f: "ð—³", g: "ð—´", h: "ð—µ", i: "ð—¶", 
    j: "ð—·", k: "ð—¸", l: "ð—¹", m: "ð—º", n: "ð—»", o: "ð—¼", p: "ð—½", q: "ð—¾", r: "ð—¿", 
    s: "ð˜€", t: "ð˜", u: "ð˜‚", v: "ð˜ƒ", w: "ð˜„", x: "ð˜…", y: "ð˜†", z: "ð˜‡",
    0: "ðŸ¬", 1: "ðŸ­", 2: "ðŸ®", 3: "ðŸ¯", 4: "ðŸ°", 5: "ðŸ±", 6: "ðŸ²", 7: "ðŸ³", 8: "ðŸ´", 9: "ðŸµ",
    " ": " "
  },
  italic: {
    A: "ð˜ˆ", B: "ð˜‰", C: "ð˜Š", D: "ð˜‹", E: "ð˜Œ", F: "ð˜", G: "ð˜Ž", H: "ð˜", I: "ð˜", 
    J: "ð˜‘", K: "ð˜’", L: "ð˜“", M: "ð˜”", N: "ð˜•", O: "ð˜–", P: "ð˜—", Q: "ð˜˜", R: "ð˜™", 
    S: "ð˜š", T: "ð˜›", U: "ð˜œ", V: "ð˜", W: "ð˜ž", X: "ð˜Ÿ", Y: "ð˜ ", Z: "ð˜¡",
    a: "ð˜¢", b: "ð˜£", c: "ð˜¤", d: "ð˜¥", e: "ð˜¦", f: "ð˜§", g: "ð˜¨", h: "ð˜©", i: "ð˜ª", 
    j: "ð˜«", k: "ð˜¬", l: "ð˜­", m: "ð˜®", n: "ð˜¯", o: "ð˜°", p: "ð˜±", q: "ð˜²", r: "ð˜³", 
    s: "ð˜´", t: "ð˜µ", u: "ð˜¶", v: "ð˜·", w: "ð˜¸", x: "ð˜¹", y: "ð˜º", z: "ð˜»",
    " ": " "
  },
  monospace: {
    A: "ð™°", B: "ð™±", C: "ð™²", D: "ð™³", E: "ð™´", F: "ð™µ", G: "ð™¶", H: "ð™·", I: "ð™¸",
    J: "ð™¹", K: "ð™º", L: "ð™»", M: "ð™¼", N: "ð™½", O: "ð™¾", P: "ð™¿", Q: "ðš€", R: "ðš",
    S: "ðš‚", T: "ðšƒ", U: "ðš„", V: "ðš…", W: "ðš†", X: "ðš‡", Y: "ðšˆ", Z: "ðš‰",
    a: "ðšŠ", b: "ðš‹", c: "ðšŒ", d: "ðš", e: "ðšŽ", f: "ðš", g: "ðš", h: "ðš‘", i: "ðš’",
    j: "ðš“", k: "ðš”", l: "ðš•", m: "ðš–", n: "ðš—", o: "ðš˜", p: "ðš™", q: "ðšš", r: "ðš›",
    s: "ðšœ", t: "ðš", u: "ðšž", v: "ðšŸ", w: "ðš ", x: "ðš¡", y: "ðš¢", z: "ðš£",
    0: "ðŸ¶", 1: "ðŸ·", 2: "ðŸ¸", 3: "ðŸ¹", 4: "ðŸº", 5: "ðŸ»", 6: "ðŸ¼", 7: "ðŸ½", 8: "ðŸ¾", 9: "ðŸ¿",
    " ": " "
  },
  underline: {
    A: "AÌ²", B: "BÌ²", C: "CÌ²", D: "DÌ²", E: "EÌ²", F: "FÌ²", G: "GÌ²", H: "HÌ²", I: "IÌ²", 
    J: "JÌ²", K: "KÌ²", L: "LÌ²", M: "MÌ²", N: "NÌ²", O: "OÌ²", P: "PÌ²", Q: "QÌ²", R: "RÌ²", 
    S: "SÌ²", T: "TÌ²", U: "UÌ²", V: "VÌ²", W: "WÌ²", X: "XÌ²", Y: "YÌ²", Z: "ZÌ²",
    a: "aÌ²", b: "bÌ²", c: "cÌ²", d: "dÌ²", e: "eÌ²", f: "fÌ²", g: "gÌ²", h: "hÌ²", i: "iÌ²", 
    j: "jÌ²", k: "kÌ²", l: "lÌ²", m: "mÌ²", n: "nÌ²", o: "oÌ²", p: "pÌ²", q: "qÌ²", r: "rÌ²", 
    s: "sÌ²", t: "tÌ²", u: "uÌ²", v: "vÌ²", w: "wÌ²", x: "xÌ²", y: "yÌ²", z: "zÌ²",
    " ": " "
  },
  strikethrough: {
    A: "ð™°Ì¶", B: "ð™±Ì¶", C: "ð™²Ì¶", D: "ð™³Ì¶", E: "ð™´Ì¶", F: "ð™µÌ¶", G: "ð™¶Ì¶", H: "ð™·Ì¶", I: "ð™¸Ì¶",
    J: "ð™¹Ì¶", K: "ð™ºÌ¶", L: "ð™»Ì¶", M: "ð™¼Ì¶", N: "ð™½Ì¶", O: "ð™¾Ì¶", P: "ð™¿Ì¶", Q: "ðš€Ì¶", R: "ðšÌ¶",
    S: "ðš‚Ì¶", T: "ðšƒÌ¶", U: "ðš„Ì¶", V: "ðš…Ì¶", W: "ðš†Ì¶", X: "ðš‡Ì¶", Y: "ðšˆÌ¶", Z: "ðš‰Ì¶",
    a: "ðšŠÌ¶", b: "ðš‹Ì¶", c: "ðšŒÌ¶", d: "ðšÌ¶", e: "ðšŽÌ¶", f: "ðšÌ¶", g: "ðšÌ¶", h: "ðš‘Ì¶", i: "ðš’Ì¶",
    j: "ðš“Ì¶", k: "ðš”Ì¶", l: "ðš•Ì¶", m: "ðš–Ì¶", n: "ðš—Ì¶", o: "ðš˜Ì¶", p: "ðš™Ì¶", q: "ðššÌ¶", r: "ðš›Ì¶",
    s: "ðšœÌ¶", t: "ðšÌ¶", u: "ðšžÌ¶", v: "ðšŸÌ¶", w: "ðš Ì¶", x: "ðš¡Ì¶", y: "ðš¢Ì¶", z: "ðš£Ì¶",
    " ": " "
  }
};

chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {
  if (request.action === "transform") {
    const transformedText = request.text
      .split("")
      .map(char => characterMaps[request.style][char] || char)
      .join("");
    
    document.execCommand("insertText", false, transformedText);
  } else if (request.action === "addBullets") {
    // Handle all possible line break scenarios
    const text = request.text;
    
    // First normalize all possible line endings to \n
    const normalizedText = text
      .replace(/\r\n/g, '\n')  // Windows
      .replace(/\r/g, '\n');   // Old Mac
      
    // Add bullet at the start of each line while preserving the line breaks
    const bulletedText = normalizedText
      .split('\n')
      .map(line => `${request.bullet}${line}`)
      .join('\n');
    
    document.execCommand("insertText", false, bulletedText);
  }
});